(function($){"use strict";$(document).ready(function($){$('.jigoshop_error, .jigoshop_message').css('opacity',0);setTimeout(function(){$('.jigoshop_error, .jigoshop_message').animate({opacity:1},1500)},100);if(jigoshop_params.load_fancybox)$('a.zoom').prettyPhoto({animation_speed:'normal',slideshow:5e3,autoplay_slideshow:false,show_title:false,theme:'pp_default',horizontal_padding:50,opacity:0.7,overlay_gallery:false,deeplinking:false,social_tools:false});$("div.quantity, td.quantity").append('<input type="button" value="+" id="add1" class="plus" />').prepend('<input type="button" value="-" id="minus1" class="minus" />');$(".plus").click(function(){var currentVal=parseInt($(this).prev(".qty").val());if(!currentVal||currentVal==""||currentVal=="NaN")currentVal=0;$(this).prev(".qty").val(currentVal+1)});$(".minus").click(function(){var currentVal=parseInt($(this).next(".qty").val());if(currentVal=="NaN")currentVal=0;if(currentVal>0)$(this).next(".qty").val(currentVal-1)})
function variations_match(attrs1,attrs2){var match=true;for(var name in attrs1){var val1=attrs1[name].toLowerCase();if(typeof(attrs2[name])=='undefined'){var val2='undefined'}else var val2=attrs2[name].toLowerCase();if(val1.length!=0&&val2.length!=0&&val1!=val2)match=false};return match}
function find_matching_variations(attributes){var matching=[];for(var i=0;i<product_variations.length;i++){var variation=product_variations[i];if(variations_match(variation.attributes,attributes))matching.push(variation)};return matching}
function update_variation_values(variations){$('.variations select').each(function(index,el){var current_attr_select=$(el);current_attr_select.find('option:gt(0)').attr('disabled','disabled');var current_attr_name=current_attr_select.attr('name');for(var num in variations){var attributes=variations[num].attributes;for(var attr_name in attributes){var attr_val=attributes[attr_name];if(attr_name==current_attr_name)if(attr_val){current_attr_select.find('option[value="'+attr_val+'"]').removeAttr('disabled')}else current_attr_select.find('option').removeAttr('disabled')}};current_attr_select.parent().prev().find('select').find('option:gt(0)').removeAttr('disabled')})}
function show_variation(variation){var img=$('div.images img:eq(0)'),link=$('div.images a.zoom:eq(0)'),o_src=$(img).attr('original-src'),o_link=$(link).attr('original-href'),variation_image=variation.image_src,variation_link=variation.image_link,var_display;if(variation.same_prices){var_display=variation.availability_html}else var_display=variation.price_html+variation.availability_html;$('.single_variation').html(var_display);if(!o_src)$(img).attr('original-src',$(img).attr('src'));if(!o_link)$(link).attr('original-href',$(link).attr('href'));if(variation_image&&variation_image.length>1){$(img).attr('src',variation_image);$(link).attr('href',variation_link)}else{$(img).attr('src',o_src);$(link).attr('href',o_link)};$('.product_meta .sku').remove();$('.product_meta').append(variation.sku);$('.shop_attributes').find('.weight').remove();if(variation.a_weight)$('.shop_attributes').append(variation.a_weight);$('.shop_attributes').find('.length').remove();if(variation.a_length)$('.shop_attributes').append(variation.a_length);$('.shop_attributes').find('.width').remove();if(variation.a_width)$('.shop_attributes').append(variation.a_width);$('.shop_attributes').find('.height').remove();if(variation.a_height)$('.shop_attributes').append(variation.a_height);if(!variation.in_stock){$('.single_variation').slideDown()}else $('.variations_button, .single_variation').slideDown()}
function check_variations(){$('form input[name=variation_id]').val('');$('.single_variation').text('');$('.variations_button, .single_variation').slideUp();$('.product_meta .sku').remove();$('.shop_attributes').find('.weight').remove();$('.shop_attributes').find('.length').remove();$('.shop_attributes').find('.width').remove();$('.shop_attributes').find('.height').remove();var all_set=true,current_attributes={};$('.variations select').each(function(){if($(this).val().length==0)all_set=false;current_attributes[$(this).attr('name')]=$(this).val()});var matching_variations=find_matching_variations(current_attributes);if(all_set){var variation=matching_variations.pop();$('form input[name=variation_id]').val(variation.variation_id);show_variation(variation)}else update_variation_values(matching_variations)};$('.variations select').change(function(){var num=$(this).data('num');if($(this).val().length>0)num+=1;var selects=$('.variations select');selects.filter(':lt('+num+')').removeAttr('disabled');selects.filter(':eq('+num+')').removeAttr('disabled').val('');selects.filter(':gt('+num+')').attr('disabled','disabled').val('');check_variations($(this))});$('.variations select:gt(0)').attr('disabled','disabled');$.each($('.variations select'),function(i,item){$(item).data('num',i)});var initial_change=null,current_attributes={},number_of_variations=$('form.variations_form .variations select').length;$('form.variations_form .variations select').each(function(i){current_attributes[$(this).attr('name')]=$(this).val();if($(this).val()!=''){if(i==number_of_variations-1&&find_matching_variations(current_attributes).length==0)return false;initial_change=$(this)}else return false});if(initial_change)initial_change.change()})})(jQuery);
(function(e){function t(){var e=location.href;hashtag=e.indexOf("#prettyPhoto")!==-1?decodeURI(e.substring(e.indexOf("#prettyPhoto")+1,e.length)):false;return hashtag}
function n(){if(typeof theRel=="undefined")return;location.hash=theRel+"/"+rel_index+"/"}
function r(){if(location.href.indexOf("#prettyPhoto")!==-1)location.hash="prettyPhoto"}
function i(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+e+"=([^&#]*)",r=new RegExp(n),i=r.exec(t);return i==null?"":i[1]};e.prettyPhoto={version:"3.1.5"};e.fn.prettyPhoto=function(s){function g(){e(".pp_loaderIcon").hide();projectedTop=scroll_pos.scrollTop+(d/2-a.containerHeight/2);if(projectedTop<0)projectedTop=0;$ppt.fadeTo(settings.animation_speed,1);$pp_pic_holder.find(".pp_content").animate({height:a.contentHeight,width:a.contentWidth},settings.animation_speed);$pp_pic_holder.animate({top:projectedTop,left:v/2-a.containerWidth/2<0?0:v/2-a.containerWidth/2,width:a.containerWidth},settings.animation_speed,function(){$pp_pic_holder.find(".pp_hoverContainer,#fullResImage").height(a.height).width(a.width);$pp_pic_holder.find(".pp_fade").fadeIn(settings.animation_speed);if(isSet&&S(pp_images[set_position])=="image"){$pp_pic_holder.find(".pp_hoverContainer").show()}else $pp_pic_holder.find(".pp_hoverContainer").hide();if(settings.allow_expand)if(a.resized){e("a.pp_expand,a.pp_contract").show()}else e("a.pp_expand").hide();if(settings.autoplay_slideshow&&!m&&!f)e.prettyPhoto.startSlideshow();settings.changepicturecallback();f=true});C();s.ajaxcallback()}
function y(t){$pp_pic_holder.find("#pp_full_res object,#pp_full_res embed").css("visibility","hidden");$pp_pic_holder.find(".pp_fade").fadeOut(settings.animation_speed,function(){e(".pp_loaderIcon").show();t()})}
function b(t){t>1?e(".pp_nav").show():e(".pp_nav").hide()}
function w(e,t){resized=false;E(e,t);imageWidth=e,imageHeight=t;if((p>v||h>d)&&doresize&&settings.allow_resize&&!u){resized=true,fitting=false;while(!fitting){if(p>v){imageWidth=v-200;imageHeight=t/e*imageWidth}else if(h>d){imageHeight=d-200;imageWidth=e/t*imageHeight}else fitting=true;h=imageHeight,p=imageWidth};if(p>v||h>d)w(p,h);E(imageWidth,imageHeight)};return{width:Math.floor(imageWidth),height:Math.floor(imageHeight),containerHeight:Math.floor(h),containerWidth:Math.floor(p)+settings.horizontal_padding*2,contentHeight:Math.floor(l),contentWidth:Math.floor(c),resized:resized}}
function E(t,n){t=parseFloat(t);n=parseFloat(n);$pp_details=$pp_pic_holder.find(".pp_details");$pp_details.width(t);detailsHeight=parseFloat($pp_details.css("marginTop"))+parseFloat($pp_details.css("marginBottom"));$pp_details=$pp_details.clone().addClass(settings.theme).width(t).appendTo(e("body")).css({position:"absolute",top:-1e4});detailsHeight+=$pp_details.height();detailsHeight=detailsHeight<=34?36:detailsHeight;$pp_details.remove();$pp_title=$pp_pic_holder.find(".ppt");$pp_title.width(t);titleHeight=parseFloat($pp_title.css("marginTop"))+parseFloat($pp_title.css("marginBottom"));$pp_title=$pp_title.clone().appendTo(e("body")).css({position:"absolute",top:-1e4});titleHeight+=$pp_title.height();$pp_title.remove();l=n+detailsHeight;c=t;h=l+titleHeight+$pp_pic_holder.find(".pp_top").height()+$pp_pic_holder.find(".pp_bottom").height();p=t}
function S(e){if(e.match(/youtube\.com\/watch/i)||e.match(/youtu\.be/i)){return"youtube"}else if(e.match(/vimeo\.com/i)){return"vimeo"}else if(e.match(/\b.mov\b/i)){return"quicktime"}else if(e.match(/\b.swf\b/i)){return"flash"}else if(e.match(/\biframe=true\b/i)){return"iframe"}else if(e.match(/\bajax=true\b/i)){return"ajax"}else if(e.match(/\bcustom=true\b/i)){return"custom"}else if(e.substr(0,1)=="#"){return"inline"}else return"image"}
function x(){if(doresize&&typeof $pp_pic_holder!="undefined"){scroll_pos=T();contentHeight=$pp_pic_holder.height(),contentwidth=$pp_pic_holder.width();projectedTop=d/2+scroll_pos.scrollTop-contentHeight/2;if(projectedTop<0)projectedTop=0;if(contentHeight>d)return;$pp_pic_holder.css({top:projectedTop,left:v/2+scroll_pos.scrollLeft-contentwidth/2})}}
function T(){if(self.pageYOffset){return{scrollTop:self.pageYOffset,scrollLeft:self.pageXOffset}}else if(document.documentElement&&document.documentElement.scrollTop){return{scrollTop:document.documentElement.scrollTop,scrollLeft:document.documentElement.scrollLeft}}else if(document.body)return{scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft}}
function N(){d=e(window).height(),v=e(window).width();if(typeof $pp_overlay!="undefined")$pp_overlay.height(e(document).height()).width(v)}
function C(){if(isSet&&settings.overlay_gallery&&S(pp_images[set_position])=="image"){itemWidth=52+5;navWidth=settings.theme=="facebook"||settings.theme=="pp_default"?50:30;itemsPerPage=Math.floor((a.containerWidth-100-navWidth)/itemWidth);itemsPerPage=itemsPerPage<pp_images.length?itemsPerPage:pp_images.length;totalPage=Math.ceil(pp_images.length/itemsPerPage)-1;if(totalPage==0){navWidth=0;$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").hide()}else $pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").show();galleryWidth=itemsPerPage*itemWidth;fullGalleryWidth=pp_images.length*itemWidth;$pp_gallery.css("margin-left",-(galleryWidth/2+navWidth/2)).find("div:first").width(galleryWidth+5).find("ul").width(fullGalleryWidth).find("li.selected").removeClass("selected");goToPage=Math.floor(set_position/itemsPerPage)<totalPage?Math.floor(set_position/itemsPerPage):totalPage;e.prettyPhoto.changeGalleryPage(goToPage);$pp_gallery_li.filter(":eq("+set_position+")").addClass("selected")}else $pp_pic_holder.find(".pp_content").unbind("mouseenter mouseleave")}
function k(t){if(settings.social_tools)facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href));settings.markup=settings.markup.replace("{pp_social}","");e("body").append(settings.markup);$pp_pic_holder=e(".pp_pic_holder"),$ppt=e(".ppt"),$pp_overlay=e("div.pp_overlay");if(isSet&&settings.overlay_gallery){currentGalleryPage=0;toInject="";for(var n=0;n<pp_images.length;n++){if(!pp_images[n].match(/\b(jpg|jpeg|png|gif)\b/gi)){classname="default";img_src=""}else{classname="";img_src=pp_images[n]};toInject+="<li class='"+classname+"'><a href='#'><img src='"+img_src+"' width='50' alt='' /></a></li>"};toInject=settings.gallery_markup.replace(/{gallery}/g,toInject);$pp_pic_holder.find("#pp_full_res").after(toInject);$pp_gallery=e(".pp_pic_holder .pp_gallery"),$pp_gallery_li=$pp_gallery.find("li");$pp_gallery.find(".pp_arrow_next").click(function(){e.prettyPhoto.changeGalleryPage("next");e.prettyPhoto.stopSlideshow();return false});$pp_gallery.find(".pp_arrow_previous").click(function(){e.prettyPhoto.changeGalleryPage("previous");e.prettyPhoto.stopSlideshow();return false});$pp_pic_holder.find(".pp_content").hover(function(){$pp_pic_holder.find(".pp_gallery:not(.disabled)").fadeIn()},function(){$pp_pic_holder.find(".pp_gallery:not(.disabled)").fadeOut()});itemWidth=52+5;$pp_gallery_li.each(function(t){e(this).find("a").click(function(){e.prettyPhoto.changePage(t);e.prettyPhoto.stopSlideshow();return false})})};if(settings.slideshow){$pp_pic_holder.find(".pp_nav").prepend('<a href="#" class="pp_play">Play</a>');$pp_pic_holder.find(".pp_nav .pp_play").click(function(){e.prettyPhoto.startSlideshow();return false})};$pp_pic_holder.attr("class","pp_pic_holder "+settings.theme);$pp_overlay.css({opacity:0,height:e(document).height(),width:e(window).width()}).bind("click",function(){if(!settings.modal)e.prettyPhoto.close()});e("a.pp_close").bind("click",function(){e.prettyPhoto.close();return false});if(settings.allow_expand)e("a.pp_expand").bind("click",function(t){if(e(this).hasClass("pp_expand")){e(this).removeClass("pp_expand").addClass("pp_contract");doresize=false}else{e(this).removeClass("pp_contract").addClass("pp_expand");doresize=true};y(function(){e.prettyPhoto.open()});return false});$pp_pic_holder.find(".pp_previous, .pp_nav .pp_arrow_previous").bind("click",function(){e.prettyPhoto.changePage("previous");e.prettyPhoto.stopSlideshow();return false});$pp_pic_holder.find(".pp_next, .pp_nav .pp_arrow_next").bind("click",function(){e.prettyPhoto.changePage("next");e.prettyPhoto.stopSlideshow();return false});x()};s=jQuery.extend({hook:"rel",animation_speed:"fast",ajaxcallback:function(){},slideshow:5e3,autoplay_slideshow:false,opacity:.8,show_title:true,allow_resize:true,allow_expand:true,default_width:500,default_height:344,counter_separator_label:"/",theme:"pp_default",horizontal_padding:20,hideflash:false,wmode:"opaque",autoplay:true,modal:false,deeplinking:true,overlay_gallery:true,overlay_gallery_max:30,keyboard_shortcuts:true,changepicturecallback:function(){},callback:function(){},ie6_fallback:true,markup:'<div class="pp_pic_holder"> 						<div class="ppt"> </div> 						<div class="pp_top"> 							<div class="pp_left"></div> 							<div class="pp_middle"></div> 							<div class="pp_right"></div> 						</div> 						<div class="pp_content_container"> 							<div class="pp_left"> 							<div class="pp_right"> 								<div class="pp_content"> 									<div class="pp_loaderIcon"></div> 									<div class="pp_fade"> 										<a href="#" class="pp_expand" title="Expand the image">Expand</a> 										<div class="pp_hoverContainer"> 											<a class="pp_next" href="#">next</a> 											<a class="pp_previous" href="#">previous</a> 										</div> 										<div id="pp_full_res"></div> 										<div class="pp_details"> 											<div class="pp_nav"> 												<a href="#" class="pp_arrow_previous">Previous</a> 												<p class="currentTextHolder">0/0</p> 												<a href="#" class="pp_arrow_next">Next</a> 											</div> 											<p class="pp_description"></p> 											<div class="pp_social">{pp_social}</div> 											<a class="pp_close" href="#">Close</a> 										</div> 									</div> 								</div> 							</div> 							</div> 						</div> 						<div class="pp_bottom"> 							<div class="pp_left"></div> 							<div class="pp_middle"></div> 							<div class="pp_right"></div> 						</div> 					</div> 					<div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery"> 								<a href="#" class="pp_arrow_previous">Previous</a> 								<div> 									<ul> 										{gallery} 									</ul> 								</div> 								<a href="#" class="pp_arrow_next">Next</a> 							</div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"><param name="autoplay" value="{autoplay}"><param name="type" value="video/quicktime"><embed src="{path}" height="{height}" width="{width}" autoplay="{autoplay}" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no"></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:"",social_tools:'<div class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script></div><div class="facebook"><iframe src="//www.facebook.com/plugins/like.php?locale=en_US&href={location_href}&layout=button_count&show_faces=true&width=500&action=like&font&colorscheme=light&height=23" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:500px; height:23px;" allowTransparency="true"></iframe></div>'},s);var o=this,u=false,a,f,l,c,h,p,d=e(window).height(),v=e(window).width(),m;doresize=true,scroll_pos=T();e(window).unbind("resize.prettyphoto").bind("resize.prettyphoto",function(){x();N()});if(s.keyboard_shortcuts)e(document).unbind("keydown.prettyphoto").bind("keydown.prettyphoto",function(t){if(typeof $pp_pic_holder!="undefined")if($pp_pic_holder.is(":visible"))switch(t.keyCode){case 37:e.prettyPhoto.changePage("previous");t.preventDefault();break;case 39:e.prettyPhoto.changePage("next");t.preventDefault();break;case 27:if(!settings.modal)e.prettyPhoto.close();t.preventDefault();break}});e.prettyPhoto.initialize=function(){settings=s;if(settings.theme=="pp_default")settings.horizontal_padding=16;theRel=e(this).attr(settings.hook);galleryRegExp=/\[(?:.*)\]/;isSet=galleryRegExp.exec(theRel)?true:false;pp_images=isSet?jQuery.map(o,function(t,n){if(e(t).attr(settings.hook).indexOf(theRel)!=-1)return e(t).attr("href")}):e.makeArray(e(this).attr("href"));pp_titles=isSet?jQuery.map(o,function(t,n){if(e(t).attr(settings.hook).indexOf(theRel)!=-1)return e(t).find("img").attr("alt")?e(t).find("img").attr("alt"):""}):e.makeArray(e(this).find("img").attr("alt"));pp_descriptions=isSet?jQuery.map(o,function(t,n){if(e(t).attr(settings.hook).indexOf(theRel)!=-1)return e(t).attr("title")?e(t).attr("title"):""}):e.makeArray(e(this).attr("title"));if(pp_images.length>settings.overlay_gallery_max)settings.overlay_gallery=false;set_position=jQuery.inArray(e(this).attr("href"),pp_images);rel_index=isSet?set_position:e("a["+settings.hook+"^='"+theRel+"']").index(e(this));k(this);if(settings.allow_resize)e(window).bind("scroll.prettyphoto",function(){x()});e.prettyPhoto.open();return false};e.prettyPhoto.open=function(t){if(typeof settings=="undefined"){settings=s;pp_images=e.makeArray(arguments[0]);pp_titles=arguments[1]?e.makeArray(arguments[1]):e.makeArray("");pp_descriptions=arguments[2]?e.makeArray(arguments[2]):e.makeArray("");isSet=pp_images.length>1?true:false;set_position=arguments[3]?arguments[3]:0;k(t.target)};if(settings.hideflash)e("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","hidden");b(e(pp_images).size());e(".pp_loaderIcon").show();if(settings.deeplinking)n();if(settings.social_tools){facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href));$pp_pic_holder.find(".pp_social").html(facebook_like_link)};if($ppt.is(":hidden"))$ppt.css("opacity",0).show();$pp_overlay.show().fadeTo(settings.animation_speed,settings.opacity);$pp_pic_holder.find(".currentTextHolder").text(set_position+1+settings.counter_separator_label+e(pp_images).size());if(typeof pp_descriptions[set_position]!="undefined"&&pp_descriptions[set_position]!=""){$pp_pic_holder.find(".pp_description").show().html(unescape(pp_descriptions[set_position]))}else $pp_pic_holder.find(".pp_description").hide();movie_width=parseFloat(i("width",pp_images[set_position]))?i("width",pp_images[set_position]):settings.default_width.toString();movie_height=parseFloat(i("height",pp_images[set_position]))?i("height",pp_images[set_position]):settings.default_height.toString();u=false;if(movie_height.indexOf("%")!=-1){movie_height=parseFloat(e(window).height()*parseFloat(movie_height)/100-150);u=true};if(movie_width.indexOf("%")!=-1){movie_width=parseFloat(e(window).width()*parseFloat(movie_width)/100-150);u=true};$pp_pic_holder.fadeIn(function(){settings.show_title&&pp_titles[set_position]!=""&&typeof pp_titles[set_position]!="undefined"?$ppt.html(unescape(pp_titles[set_position])):$ppt.html(" ");imgPreloader="";skipInjection=false;switch(S(pp_images[set_position])){case"image":imgPreloader=new Image();nextImage=new Image();if(isSet&&set_position<e(pp_images).size()-1)nextImage.src=pp_images[set_position+1];prevImage=new Image();if(isSet&&pp_images[set_position-1])prevImage.src=pp_images[set_position-1];$pp_pic_holder.find("#pp_full_res")[0].innerHTML=settings.image_markup.replace(/{path}/g,pp_images[set_position]);imgPreloader.onload=function(){a=w(imgPreloader.width,imgPreloader.height);g()};imgPreloader.onerror=function(){alert("Image cannot be loaded. Make sure the path is correct and image exist.");e.prettyPhoto.close()};imgPreloader.src=pp_images[set_position];break;case"youtube":a=w(movie_width,movie_height);movie_id=i("v",pp_images[set_position]);if(movie_id==""){movie_id=pp_images[set_position].split("youtu.be/");movie_id=movie_id[1];if(movie_id.indexOf("?")>0)movie_id=movie_id.substr(0,movie_id.indexOf("?"));if(movie_id.indexOf("&")>0)movie_id=movie_id.substr(0,movie_id.indexOf("&"))};movie="http://www.youtube.com/embed/"+movie_id;i("rel",pp_images[set_position])?movie+="?rel="+i("rel",pp_images[set_position]):movie+="?rel=1";if(settings.autoplay)movie+="&autoplay=1";toInject=settings.iframe_markup.replace(/{width}/g,a.width).replace(/{height}/g,a.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,movie);break;case"vimeo":a=w(movie_width,movie_height);movie_id=pp_images[set_position];var t=/http(s?):\/\/(www\.)?vimeo.com\/(\d+)/,n=movie_id.match(t);movie="http://player.vimeo.com/video/"+n[3]+"?title=0&byline=0&portrait=0";if(settings.autoplay)movie+="&autoplay=1;";vimeo_width=a.width+"/embed/?moog_width="+a.width;toInject=settings.iframe_markup.replace(/{width}/g,vimeo_width).replace(/{height}/g,a.height).replace(/{path}/g,movie);break;case"quicktime":a=w(movie_width,movie_height);a.height+=15;a.contentHeight+=15;a.containerHeight+=15;toInject=settings.quicktime_markup.replace(/{width}/g,a.width).replace(/{height}/g,a.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,pp_images[set_position]).replace(/{autoplay}/g,settings.autoplay);break;case"flash":a=w(movie_width,movie_height);flash_vars=pp_images[set_position];flash_vars=flash_vars.substring(pp_images[set_position].indexOf("flashvars")+10,pp_images[set_position].length);filename=pp_images[set_position];filename=filename.substring(0,filename.indexOf("?"));toInject=settings.flash_markup.replace(/{width}/g,a.width).replace(/{height}/g,a.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,filename+"?"+flash_vars);break;case"iframe":a=w(movie_width,movie_height);frame_url=pp_images[set_position];frame_url=frame_url.substr(0,frame_url.indexOf("iframe")-1);toInject=settings.iframe_markup.replace(/{width}/g,a.width).replace(/{height}/g,a.height).replace(/{path}/g,frame_url);break;case"ajax":doresize=false;a=w(movie_width,movie_height);doresize=true;skipInjection=true;e.get(pp_images[set_position],function(e){toInject=settings.inline_markup.replace(/{content}/g,e);$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;g()});break;case"custom":a=w(movie_width,movie_height);toInject=settings.custom_markup;break;case"inline":myClone=e(pp_images[set_position]).clone().append('<br clear="all" />').css({width:settings.default_width}).wrapInner('<div id="pp_full_res"><div class="pp_inline"></div></div>').appendTo(e("body")).show();doresize=false;a=w(e(myClone).width(),e(myClone).height());doresize=true;e(myClone).remove();toInject=settings.inline_markup.replace(/{content}/g,e(pp_images[set_position]).html());break};if(!imgPreloader&&!skipInjection){$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;g()}});return false};e.prettyPhoto.changePage=function(t){currentGalleryPage=0;if(t=="previous"){set_position--;if(set_position<0)set_position=e(pp_images).size()-1}else if(t=="next"){set_position++;if(set_position>e(pp_images).size()-1)set_position=0}else set_position=t;rel_index=set_position;if(!doresize)doresize=true;if(settings.allow_expand)e(".pp_contract").removeClass("pp_contract").addClass("pp_expand");y(function(){e.prettyPhoto.open()})};e.prettyPhoto.changeGalleryPage=function(e){if(e=="next"){currentGalleryPage++;if(currentGalleryPage>totalPage)currentGalleryPage=0}else if(e=="previous"){currentGalleryPage--;if(currentGalleryPage<0)currentGalleryPage=totalPage}else currentGalleryPage=e;slide_speed=e=="next"||e=="previous"?settings.animation_speed:0;slide_to=currentGalleryPage*itemsPerPage*itemWidth;$pp_gallery.find("ul").animate({left:-slide_to},slide_speed)};e.prettyPhoto.startSlideshow=function(){if(typeof m=="undefined"){$pp_pic_holder.find(".pp_play").unbind("click").removeClass("pp_play").addClass("pp_pause").click(function(){e.prettyPhoto.stopSlideshow();return false});m=setInterval(e.prettyPhoto.startSlideshow,settings.slideshow)}else e.prettyPhoto.changePage("next")};e.prettyPhoto.stopSlideshow=function(){$pp_pic_holder.find(".pp_pause").unbind("click").removeClass("pp_pause").addClass("pp_play").click(function(){e.prettyPhoto.startSlideshow();return false});clearInterval(m);m=undefined};e.prettyPhoto.close=function(){if($pp_overlay.is(":animated"))return;e.prettyPhoto.stopSlideshow();$pp_pic_holder.stop().find("object,embed").css("visibility","hidden");e("div.pp_pic_holder,div.ppt,.pp_fade").fadeOut(settings.animation_speed,function(){e(this).remove()});$pp_overlay.fadeOut(settings.animation_speed,function(){if(settings.hideflash)e("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","visible");e(this).remove();e(window).unbind("scroll.prettyphoto");r();settings.callback();doresize=true;f=false;delete settings})};if(!pp_alreadyInitialized&&t()){pp_alreadyInitialized=true;hashIndex=t();hashRel=hashIndex;hashIndex=hashIndex.substring(hashIndex.indexOf("/")+1,hashIndex.length-1);hashRel=hashRel.substring(0,hashRel.indexOf("/"));setTimeout(function(){e("a["+s.hook+"^='"+hashRel+"']:eq("+hashIndex+")").trigger("click")},50)};return this.unbind("click.prettyphoto").bind("click.prettyphoto",e.prettyPhoto.initialize)}})(jQuery);var pp_alreadyInitialized=false
"use strict"
function setup($){$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){},msie=/MSIE/.test(navigator.userAgent),ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),mode=document.documentMode||0,setExpr=$.isFunction(document.createElement('div').style.setExpression);$.blockUI=function(opts){install(window,opts)};$.unblockUI=function(opts){remove(window,opts)};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append('<h1>'+title+'</h1>');if(message)$m.append('<h2>'+message+'</h2>');if(timeout===undefined)timeout=3e3;$.blockUI({message:$m,fadeIn:700,fadeOut:1e3,centerY:false,timeout:timeout,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};$.fn.block=function(opts){if(this[0]===window){$.blockUI(opts);return this};var fullOpts=$.extend({},$.blockUI.defaults,opts||{});this.each(function(){var $el=$(this);if(fullOpts.ignoreIfBlocked&&$el.data('blockUI.isBlocked'))return;$el.unblock({fadeOut:0})});return this.each(function(){if($.css(this,'position')=='static'){this.style.position='relative';$(this).data('blockUI.static',true)};this.style.zoom=1;install(this,opts)})};$.fn.unblock=function(opts){if(this[0]===window){$.unblockUI(opts);return this};return this.each(function(){remove(this,opts)})};$.blockUI.version=2.59;$.blockUI.defaults={message:'<h1>Please wait...</h1>',title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:'30%',top:'40%',left:'35%',textAlign:'center',color:'#000',border:'3px solid #aaa',backgroundColor:'#fff',cursor:'wait'},themedCSS:{width:'30%',top:'40%',left:'35%'},overlayCSS:{backgroundColor:'#000',opacity:0.6,cursor:'wait'},cursorReset:'default',growlCSS:{width:'350px',top:'10px',left:'',right:'10px',border:'none',padding:'5px',opacity:0.6,cursor:'default',color:'#fff',backgroundColor:'#000','-webkit-border-radius':'10px','-moz-border-radius':'10px','border-radius':'10px'},iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank',forceIframe:false,baseZ:1e3,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:'blockMsg',ignoreIfBlocked:false};var pageBlock=null,pageBlockEls=[]
function install(el,opts){var css,themedCSS,full=(el==window),msg=(opts&&opts.message!==undefined?opts.message:undefined);opts=$.extend({},$.blockUI.defaults,opts||{});if(opts.ignoreIfBlocked&&$(el).data('blockUI.isBlocked'))return;opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});css=$.extend({},$.blockUI.defaults.css,opts.css||{});if(opts.onOverlayClick)opts.overlayCSS.cursor='pointer';themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)remove(window,{fadeOut:0});if(msg&&typeof msg!='string'&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg,data={};$(el).data('blockUI.history',data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)data.parent.removeChild(node)};$(el).data('blockUI.onUnblock',opts.onUnblock);var z=opts.baseZ,lyr1,lyr2,lyr3,s;if(msie||opts.forceIframe){lyr1=$('<iframe class="blockUI" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>')}else lyr1=$('<div class="blockUI" style="display:none"></div>');if(opts.theme){lyr2=$('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+(z++)+';display:none"></div>')}else lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');if(opts.theme&&full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">';if(opts.title)s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||'&nbsp;')+'</div>';s+='<div class="ui-widget-content ui-dialog-content"></div>';s+='</div>'}else if(opts.theme){s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">';if(opts.title)s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||'&nbsp;')+'</div>';s+='<div class="ui-widget-content ui-dialog-content"></div>';s+='</div>'}else if(full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>'}else s='<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>';lyr3=$(s);if(msg)if(opts.theme){lyr3.css(themedCSS);lyr3.addClass('ui-widget-content')}else lyr3.css(css);if(!opts.theme)lyr2.css(opts.overlayCSS);lyr2.css('position',full?'fixed':'absolute');if(msie||opts.forceIframe)lyr1.css('opacity',0.0);var layers=[lyr1,lyr2,lyr3],$par=full?$('body'):$(el);$.each(layers,function(){this.appendTo($par)});if(opts.theme&&opts.draggable&&$.fn.draggable)lyr3.draggable({handle:'.ui-dialog-titlebar',cancel:'li'});var expr=setExpr&&(!$.support.boxModel||$('object,embed',full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.support.boxModel)$('html,body').css('height','100%');if((ie6||!$.support.boxModel)&&!full){var t=sz(el,'borderTopWidth'),l=sz(el,'borderLeftWidth'),fixT=t?'(0 - '+t+')':0,fixL=l?'(0 - '+l+')':0};$.each(layers,function(i,o){var s=o[0].style;s.position='absolute';if(i<2){if(full){s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"')}else s.setExpression('height','this.parentNode.offsetHeight + "px"');if(full){s.setExpression('width','jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"')}else s.setExpression('width','this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression('left',fixL);if(fixT)s.setExpression('top',fixT)}else if(opts.centerY){if(full)s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0}else if(!opts.centerY&&full){var top=(opts.css&&opts.css.top)?parseInt(opts.css.top,10):0,expression='((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';s.setExpression('top',expression)}})};if(msg){if(opts.theme){lyr3.find('.ui-widget-content').append(msg)}else lyr3.append(msg);if(msg.jquery||msg.nodeType)$(msg).show()};if((msie||opts.forceIframe)&&opts.showOverlay)lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp,cb1=(opts.showOverlay&&!msg)?cb:noOp,cb2=msg?cb:noOp;if(opts.showOverlay)lyr2._fadeIn(opts.fadeIn,cb1);if(msg)lyr3._fadeIn(opts.fadeIn,cb2)}else{if(opts.showOverlay)lyr2.show();if(msg)lyr3.show();if(opts.onBlock)opts.onBlock()};bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(':input:enabled:visible',pageBlock);if(opts.focusInput)setTimeout(focus,20)}else center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){if(full){$.unblockUI(opts)}else $(el).unblock(opts)},opts.timeout);$(el).data('blockUI.timeout',to)}}
function remove(el,opts){var count,full=(el==window),$el=$(el),data=$el.data('blockUI.history'),to=$el.data('blockUI.timeout');if(to){clearTimeout(to);$el.removeData('blockUI.timeout')};opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);if(opts.onUnblock===null){opts.onUnblock=$el.data('blockUI.onUnblock');$el.removeData('blockUI.onUnblock')};var els;if(full){els=$('body').children().filter('.blockUI').add('body > .blockUI')}else els=$el.find('>.blockUI');if(opts.cursorReset){if(els.length>1)els[1].style.cursor=opts.cursorReset;if(els.length>2)els[2].style.cursor=opts.cursorReset};if(full)pageBlock=pageBlockEls=null;if(opts.fadeOut){count=els.length;els.fadeOut(opts.fadeOut,function(){if(--count===0)reset(els,data,opts,el)})}else reset(els,data,opts,el)}
function reset(els,data,opts,el){var $el=$(el);els.each(function(i,o){if(this.parentNode)this.parentNode.removeChild(this)});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;if(data.parent)data.parent.appendChild(data.el);$el.removeData('blockUI.history')};if($el.data('blockUI.static'))$el.css('position','static');if(typeof opts.onUnblock=='function')opts.onUnblock(el,opts);var body=$(document.body),w=body.width(),cssW=body[0].style.width;body.width(w-1).width(w);body[0].style.width=cssW}
function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data('blockUI.isBlocked')))return;$el.data('blockUI.isBlocked',b);if(!full||!opts.bindEvents||(b&&!opts.showOverlay))return;var events='mousedown mouseup keydown keypress keyup touchstart touchend touchmove';if(b){$(document).bind(events,opts,handler)}else $(document).unbind(events,handler)}
function handler(e){if(e.keyCode&&e.keyCode==9)if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls,fwd=!e.shiftKey&&e.target===els[els.length-1],back=e.shiftKey&&e.target===els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false}};var opts=e.data,target=$(e.target);if(target.hasClass('blockOverlay')&&opts.onOverlayClick)opts.onOverlayClick();if(target.parents('div.'+opts.blockMsgClass).length>0)return true;return target.parents().children().filter('div.blockUI').length===0}
function focus(back){if(!pageBlockEls)return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)e.focus()}
function center(el,x,y){var p=el.parentNode,s=el.style,l=((p.offsetWidth-el.offsetWidth)/2)-sz(p,'borderLeftWidth'),t=((p.offsetHeight-el.offsetHeight)/2)-sz(p,'borderTopWidth');if(x)s.left=l>0?(l+'px'):'0';if(y)s.top=t>0?(t+'px'):'0'}
function sz(el,p){return parseInt($.css(el,p),10)||0}};(function($){$(document).ready(function(){if(typeof define==='function'&&define.amd&&define.amd.jQuery){define(['jquery'],setup)}else setup($)})})(jQuery);
jQuery(document).ready(function(){function updateCharactersLimit(object){if(jQuery(object).parents('.form-row').find('.jpacl-counter-value').length){var new_value=jQuery(object).attr('maxlength')-jQuery(object).val().length;if(new_value<0)new_value=0;jQuery(object).parents('.form-row').find('.jpacl-counter-value').html(new_value)}};jQuery('.form, .variations_form').on('keypress keydown keyup click','.product-addon textarea.input-text, .product-addon input[type=text].input-text',function(){updateCharactersLimit(this)});jQuery('.product-addon textarea.input-text, .product-addon input[type=text].input-text').each(function(){updateCharactersLimit(this)})});
var qq=function(element){"use strict";return{hide:function(){element.style.display='none';return this},attach:function(type,fn){if(element.addEventListener){element.addEventListener(type,fn,false)}else if(element.attachEvent)element.attachEvent('on'+type,fn);return function(){qq(element).detach(type,fn)}},detach:function(type,fn){if(element.removeEventListener){element.removeEventListener(type,fn,false)}else if(element.attachEvent)element.detachEvent('on'+type,fn);return this},contains:function(descendant){if(element===descendant)return true;if(element.contains){return element.contains(descendant)}else return!!(descendant.compareDocumentPosition(element)&8)},insertBefore:function(elementB){elementB.parentNode.insertBefore(element,elementB);return this},remove:function(){element.parentNode.removeChild(element);return this},css:function(styles){if(styles.opacity!==null)if(typeof element.style.opacity!=='string'&&typeof(element.filters)!=='undefined')styles.filter='alpha(opacity='+Math.round(100*styles.opacity)+')';qq.extend(element.style,styles);return this},hasClass:function(name){var re=new RegExp('(^| )'+name+'( |$)');return re.test(element.className)},addClass:function(name){if(!qq(element).hasClass(name))element.className+=' '+name;return this},removeClass:function(name){var re=new RegExp('(^| )'+name+'( |$)');element.className=element.className.replace(re,' ').replace(/^\s+|\s+$/g,"");return this},getByClass:function(className){var candidates,result=[];if(element.querySelectorAll)return element.querySelectorAll('.'+className);candidates=element.getElementsByTagName("*");qq.each(candidates,function(idx,val){if(qq(val).hasClass(className))result.push(val)});return result},children:function(){var children=[],child=element.firstChild;while(child){if(child.nodeType===1)children.push(child);child=child.nextSibling};return children},setText:function(text){element.innerText=text;element.textContent=text;return this},clearText:function(){return qq(element).setText("")}}};qq.log=function(message,level){"use strict";if(window.console)if(!level||level==='info'){window.console.log(message)}else if(window.console[level]){window.console[level](message)}else window.console.log('<'+level+'> '+message)};qq.isObject=function(variable){"use strict";return variable!==null&&variable&&typeof variable==="object"&&variable.constructor===Object};qq.isFunction=function(variable){"use strict";return typeof variable==="function"};qq.isFileOrInput=function(maybeFileOrInput){"use strict";if(window.File&&maybeFileOrInput instanceof File){return true}else if(window.HTMLInputElement){if(maybeFileOrInput instanceof HTMLInputElement)if(maybeFileOrInput.type&&maybeFileOrInput.type.toLowerCase()==='file')return true}else if(maybeFileOrInput.tagName)if(maybeFileOrInput.tagName.toLowerCase()==='input')if(maybeFileOrInput.type&&maybeFileOrInput.type.toLowerCase()==='file')return true;return false};qq.isXhrUploadSupported=function(){"use strict";var input=document.createElement('input');input.type='file';return(input.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof(new XMLHttpRequest()).upload!=="undefined")};qq.isFolderDropSupported=function(dataTransfer){"use strict";return(dataTransfer.items&&dataTransfer.items[0].webkitGetAsEntry)};qq.isFileChunkingSupported=function(){"use strict";return!qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice)};qq.extend=function(first,second,extendNested){"use strict";qq.each(second,function(prop,val){if(extendNested&&qq.isObject(val)){if(first[prop]===undefined)first[prop]={};qq.extend(first[prop],val,true)}else first[prop]=val})};qq.indexOf=function(arr,elt,from){"use strict";if(arr.indexOf)return arr.indexOf(elt,from);from=from||0;var len=arr.length;if(from<0)from+=len;for(;from<len;from+=1)if(arr.hasOwnProperty(from)&&arr[from]===elt)return from;return-1};qq.getUniqueId=function(){"use strict";return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16)})};qq.ie=function(){"use strict";return navigator.userAgent.indexOf('MSIE')!==-1};qq.ie10=function(){"use strict";return navigator.userAgent.indexOf('MSIE 10')!==-1};qq.safari=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf('Google')!==-1};qq.firefox=function(){"use strict";return(navigator.userAgent.indexOf('Mozilla')!==-1&&navigator.vendor!==undefined&&navigator.vendor==='')};qq.windows=function(){"use strict";return navigator.platform==="Win32"};qq.android=function(){"use strict";return navigator.userAgent.toLowerCase().indexOf('android')!==-1};qq.preventDefault=function(e){"use strict";if(e.preventDefault){e.preventDefault()}else e.returnValue=false};qq.toElement=(function(){"use strict";var div=document.createElement('div');return function(html){div.innerHTML=html;var element=div.firstChild;div.removeChild(element);return element}}());qq.each=function(obj,callback){"use strict";var key,retVal;if(obj)for(key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){retVal=callback(key,obj[key]);if(retVal===false)break}};qq.obj2url=function(obj,temp,prefixDone){"use strict";var i,len,uristrings=[],prefix='&',add=function(nextObj,i){var nextTemp=temp?(/\[\]$/.test(temp))?temp:temp+'['+i+']':i;if((nextTemp!=='undefined')&&(i!=='undefined'))uristrings.push((typeof nextObj==='object')?qq.obj2url(nextObj,nextTemp,true):(Object.prototype.toString.call(nextObj)==='[object Function]')?encodeURIComponent(nextTemp)+'='+encodeURIComponent(nextObj()):encodeURIComponent(nextTemp)+'='+encodeURIComponent(nextObj))};if(!prefixDone&&temp){prefix=(/\?/.test(temp))?(/\?$/.test(temp))?'':'&':'?';uristrings.push(temp);uristrings.push(qq.obj2url(obj))}else if((Object.prototype.toString.call(obj)==='[object Array]')&&(typeof obj!=='undefined')){for(i=-1,len=obj.length;i<len;i+=1)add(obj[i],i)}else if((typeof obj!=='undefined')&&(obj!==null)&&(typeof obj==="object")){for(i in obj)if(obj.hasOwnProperty(i))add(obj[i],i)}else uristrings.push(encodeURIComponent(temp)+'='+encodeURIComponent(obj));if(temp){return uristrings.join(prefix)}else return uristrings.join(prefix).replace(/^&/,'').replace(/%20/g,'+')};qq.obj2FormData=function(obj,formData,arrayKeyName){"use strict";if(!formData)formData=new FormData();qq.each(obj,function(key,val){key=arrayKeyName?arrayKeyName+'['+key+']':key;if(qq.isObject(val)){qq.obj2FormData(val,formData,key)}else if(qq.isFunction(val)){formData.append(encodeURIComponent(key),encodeURIComponent(val()))}else formData.append(encodeURIComponent(key),encodeURIComponent(val))});return formData};qq.obj2Inputs=function(obj,form){"use strict";var input;if(!form)form=document.createElement('form');qq.obj2FormData(obj,{append:function(key,val){input=document.createElement('input');input.setAttribute('name',key);input.setAttribute('value',val);form.appendChild(input)}});return form};qq.setCookie=function(name,value,days){var date=new Date(),expires="";if(days){date.setTime(date.getTime()+(days*24*60*60*1e3));expires="; expires="+date.toGMTString()};document.cookie=name+"="+value+expires+"; path=/"};qq.getCookie=function(name){var nameEQ=name+"=",ca=document.cookie.split(';'),c;for(var i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length)}};qq.getCookieNames=function(regexp){var cookies=document.cookie.split(';'),cookieNames=[];qq.each(cookies,function(idx,cookie){cookie=cookie.trim();var equalsIdx=cookie.indexOf("=");if(cookie.match(regexp))cookieNames.push(cookie.substr(0,equalsIdx))});return cookieNames};qq.deleteCookie=function(name){qq.setCookie(name,"",-1)};qq.areCookiesEnabled=function(){var randNum=Math.random()*1e5,name="qqCookieTest:"+randNum;qq.setCookie(name,1);if(qq.getCookie(name)){qq.deleteCookie(name);return true};return false};qq.parseJson=function(json){if(typeof JSON.parse==="function"){return JSON.parse(json)}else return eval("("+json+")")};qq.DisposeSupport=function(){"use strict";var disposers=[];return{dispose:function(){var disposer;do{disposer=disposers.shift();if(disposer)disposer()}while(disposer)},attach:function(){var args=arguments;this.addDisposer(qq(args[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(disposeFunction){disposers.push(disposeFunction)}}};qq.UploadButton=function(o){this._options={element:null,multiple:false,acceptFiles:null,name:'file',onChange:function(input){},hoverClass:'qq-upload-button-hover',focusClass:'qq-upload-button-focus'};qq.extend(this._options,o);this._disposeSupport=new qq.DisposeSupport();this._element=this._options.element;qq(this._element).css({position:'relative',overflow:'hidden',direction:'ltr'});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode)qq(this._input).remove();qq(this._element).removeClass(this._options.focusClass);this._input=this._createInput()},_createInput:function(){var input=document.createElement("input");if(this._options.multiple)input.setAttribute("multiple","multiple");if(this._options.acceptFiles)input.setAttribute("accept",this._options.acceptFiles);input.setAttribute("type","file");input.setAttribute("name",this._options.name);qq(input).css({position:'absolute',right:0,top:0,fontFamily:'Arial',fontSize:'118px',margin:0,padding:0,cursor:'pointer',opacity:0});this._element.appendChild(input);var self=this;this._disposeSupport.attach(input,'change',function(){self._options.onChange(input)});this._disposeSupport.attach(input,'mouseover',function(){qq(self._element).addClass(self._options.hoverClass)});this._disposeSupport.attach(input,'mouseout',function(){qq(self._element).removeClass(self._options.hoverClass)});this._disposeSupport.attach(input,'focus',function(){qq(self._element).addClass(self._options.focusClass)});this._disposeSupport.attach(input,'blur',function(){qq(self._element).removeClass(self._options.focusClass)});if(window.attachEvent)input.setAttribute('tabIndex',"-1");return input}};qq.FineUploaderBasic=function(o){var that=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:'/server/upload',params:{},paramsInBody:false,customHeaders:{},forceMultipart:true,inputName:'qqfile',uuidName:'qquuid',totalFileSizeName:'qqtotalfilesize'},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(id,fileName){},onComplete:function(id,fileName,responseJSON){},onCancel:function(id,fileName){},onUpload:function(id,fileName){},onUploadChunk:function(id,fileName,chunkData){},onResume:function(id,fileName,chunkData){},onProgress:function(id,fileName,loaded,total){},onError:function(id,fileName,reason){},onAutoRetry:function(id,fileName,attemptNumber){},onManualRetry:function(id,fileName){},onValidateBatch:function(fileData){},onValidate:function(fileData){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:'preventRetry'},classes:{buttonHover:'qq-upload-button-hover',buttonFocus:'qq-upload-button-focus'},chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:'qqpartindex',partByteOffset:'qqpartbyteoffset',chunkSize:'qqchunksize',totalFileSize:'qqtotalfilesize',totalParts:'qqtotalparts',filename:'qqfilename'}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(fileName){if(fileName.length>33)fileName=fileName.slice(0,19)+'...'+fileName.slice(-14);return fileName},text:{sizeSymbols:['kB','MB','GB','TB','PB','EB']}};qq.extend(this._options,o,true);this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport();this._filesInProgress=[];this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._paramsStore=this._createParamsStore();this._endpointStore=this._createEndpointStore();this._handler=this._createUploadHandler();if(this._options.button)this._button=this._createUploadButton(this._options.button);this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(str,level){if(this._options.debug&&(!level||level==='info')){qq.log('[FineUploader] '+str)}else if(level&&level!=='info')qq.log('[FineUploader] '+str,level)},setParams:function(params,fileId){if(fileId==null){this._options.request.params=params}else this._paramsStore.setParams(params,fileId)},setEndpoint:function(endpoint,fileId){if(fileId==null){this._options.request.endpoint=endpoint}else this._endpointStore.setEndpoint(endpoint,fileId)},getInProgress:function(){return this._filesInProgress.length},uploadStoredFiles:function(){"use strict";var idToUpload;while(this._storedFileIds.length){idToUpload=this._storedFileIds.shift();this._filesInProgress.push(idToUpload);this._handler.upload(idToUpload)}},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(id){if(this._onBeforeManualRetry(id)){this._handler.retry(id);return true}else return false},cancel:function(fileId){this._handler.cancel(fileId)},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=[];this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset();this._paramsStore.reset();this._endpointStore.reset()},addFiles:function(filesOrInputs){var self=this,verifiedFilesOrInputs=[],index,fileOrInput;if(filesOrInputs){if(!window.FileList||!(filesOrInputs instanceof FileList))filesOrInputs=[].concat(filesOrInputs);for(index=0;index<filesOrInputs.length;index+=1){fileOrInput=filesOrInputs[index];if(qq.isFileOrInput(fileOrInput)){verifiedFilesOrInputs.push(fileOrInput)}else self.log(fileOrInput+' is not a File or INPUT element!  Ignoring!','warn')};this.log('Processing '+verifiedFilesOrInputs.length+' files or inputs...');this._uploadFileList(verifiedFilesOrInputs)}},getUuid:function(fileId){return this._handler.getUuid(fileId)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(fileId){return this._handler.getSize(fileId)},getFile:function(fileId){return this._handler.getFile(fileId)},_createUploadButton:function(element){var self=this,button=new qq.UploadButton({element:element,multiple:this._options.multiple&&qq.isXhrUploadSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(input){self._onInputChange(input)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){button.dispose()});return button},_createUploadHandler:function(){var self=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,log:function(str,level){self.log(str,level)},onProgress:function(id,fileName,loaded,total){self._onProgress(id,fileName,loaded,total);self._options.callbacks.onProgress(id,fileName,loaded,total)},onComplete:function(id,fileName,result,xhr){self._onComplete(id,fileName,result,xhr);self._options.callbacks.onComplete(id,fileName,result)},onCancel:function(id,fileName){self._onCancel(id,fileName);self._options.callbacks.onCancel(id,fileName)},onUpload:function(id,fileName){self._onUpload(id,fileName);self._options.callbacks.onUpload(id,fileName)},onUploadChunk:function(id,fileName,chunkData){self._options.callbacks.onUploadChunk(id,fileName,chunkData)},onResume:function(id,fileName,chunkData){return self._options.callbacks.onResume(id,fileName,chunkData)},onAutoRetry:function(id,fileName,responseJSON,xhr){self._preventRetries[id]=responseJSON[self._options.retry.preventRetryResponseProperty];if(self._shouldAutoRetry(id,fileName,responseJSON)){self._maybeParseAndSendUploadError(id,fileName,responseJSON,xhr);self._options.callbacks.onAutoRetry(id,fileName,self._autoRetries[id]+1);self._onBeforeAutoRetry(id,fileName);self._retryTimeouts[id]=setTimeout(function(){self._onAutoRetry(id,fileName,responseJSON)},self._options.retry.autoAttemptDelay*1e3);return true}else return false}})},_preventLeaveInProgress:function(){var self=this;this._disposeSupport.attach(window,'beforeunload',function(e){if(!self._filesInProgress.length)return;var e=e||window.event;e.returnValue=self._options.messages.onLeave;return self._options.messages.onLeave})},_onSubmit:function(id,fileName){if(this._options.autoUpload)this._filesInProgress.push(id)},_onProgress:function(id,fileName,loaded,total){},_onComplete:function(id,fileName,result,xhr){this._removeFromFilesInProgress(id);this._maybeParseAndSendUploadError(id,fileName,result,xhr)},_onCancel:function(id,fileName){this._removeFromFilesInProgress(id);clearTimeout(this._retryTimeouts[id]);var storedFileIndex=qq.indexOf(this._storedFileIds,id);if(!this._options.autoUpload&&storedFileIndex>=0)this._storedFileIds.splice(storedFileIndex,1)},_removeFromFilesInProgress:function(id){var index=qq.indexOf(this._filesInProgress,id);if(index>=0)this._filesInProgress.splice(index,1)},_onUpload:function(id,fileName){},_onInputChange:function(input){if(qq.isXhrUploadSupported()){this.addFiles(input.files)}else this.addFiles(input);this._button.reset()},_onBeforeAutoRetry:function(id,fileName){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+fileName+"...")},_onAutoRetry:function(id,fileName,responseJSON){this.log("Retrying "+fileName+"...");this._autoRetries[id]++;this._handler.retry(id)},_shouldAutoRetry:function(id,fileName,responseJSON){if(!this._preventRetries[id]&&this._options.retry.enableAuto){if(this._autoRetries[id]===undefined)this._autoRetries[id]=0;return this._autoRetries[id]<this._options.retry.maxAutoAttempts};return false},_onBeforeManualRetry:function(id){if(this._preventRetries[id]){this.log("Retries are forbidden for id "+id,'warn');return false}else if(this._handler.isValid(id)){var fileName=this._handler.getName(id);if(this._options.callbacks.onManualRetry(id,fileName)===false)return false;this.log("Retrying upload for '"+fileName+"' (id: "+id+")...");this._filesInProgress.push(id);return true}else{this.log("'"+id+"' is not a valid file ID",'error');return false}},_maybeParseAndSendUploadError:function(id,fileName,response,xhr){if(!response.success)if(xhr&&xhr.status!==200&&!response.error){this._options.callbacks.onError(id,fileName,"XHR returned response code "+xhr.status)}else{var errorReason=response.error?response.error:"Upload failure reason unknown";this._options.callbacks.onError(id,fileName,errorReason)}},_uploadFileList:function(files){var validationDescriptors,index,batchInvalid;validationDescriptors=this._getValidationDescriptors(files);batchInvalid=this._options.callbacks.onValidateBatch(validationDescriptors)===false;if(!batchInvalid)if(files.length>0){for(index=0;index<files.length;index++)if(this._validateFile(files[index])){this._uploadFile(files[index])}else if(this._options.validation.stopOnFirstInvalidFile)return}else this._error('noFilesError',"")},_uploadFile:function(fileContainer){var id=this._handler.add(fileContainer),fileName=this._handler.getName(id);if(this._options.callbacks.onSubmit(id,fileName)!==false){this._onSubmit(id,fileName);if(this._options.autoUpload){this._handler.upload(id)}else this._storeFileForLater(id)}},_storeFileForLater:function(id){this._storedFileIds.push(id)},_validateFile:function(file){var validationDescriptor,name,size;validationDescriptor=this._getValidationDescriptor(file);name=validationDescriptor.name;size=validationDescriptor.size;if(this._options.callbacks.onValidate(validationDescriptor)===false)return false;if(!this._isAllowedExtension(name)){this._error('typeError',name);return false}else if(size===0){this._error('emptyError',name);return false}else if(size&&this._options.validation.sizeLimit&&size>this._options.validation.sizeLimit){this._error('sizeError',name);return false}else if(size&&size<this._options.validation.minSizeLimit){this._error('minSizeError',name);return false};return true},_error:function(code,fileName){var message=this._options.messages[code]
function r(name,replacement){message=message.replace(name,replacement)};var extensions=this._options.validation.allowedExtensions.join(', ').toLowerCase();r('{file}',this._options.formatFileName(fileName));r('{extensions}',extensions);r('{sizeLimit}',this._formatSize(this._options.validation.sizeLimit));r('{minSizeLimit}',this._formatSize(this._options.validation.minSizeLimit));this._options.callbacks.onError(null,fileName,message);return message},_isAllowedExtension:function(fileName){var allowed=this._options.validation.allowedExtensions,valid=false;if(!allowed.length)return true;qq.each(allowed,function(idx,allowedExt){var extRegex=new RegExp('\\.'+allowedExt+"$",'i');if(fileName.match(extRegex)!=null){valid=true;return false}});return valid},_formatSize:function(bytes){var i=-1;do{bytes=bytes/1024;i++}while(bytes>99);return Math.max(bytes,0.1).toFixed(1)+this._options.text.sizeSymbols[i]},_wrapCallbacks:function(){var self,safeCallback;self=this;safeCallback=function(name,callback,args){try{return callback.apply(self,args)}catch(exception){self.log("Caught exception in '"+name+"' callback - "+exception.message,'error')}};for(var prop in this._options.callbacks)(function(){var callbackName,callbackFunc;callbackName=prop;callbackFunc=self._options.callbacks[callbackName];self._options.callbacks[callbackName]=function(){return safeCallback(callbackName,callbackFunc,arguments)}}())},_parseFileName:function(file){var name;if(file.value){name=file.value.replace(/.*(\/|\\)/,"")}else name=(file.fileName!==null&&file.fileName!==undefined)?file.fileName:file.name;return name},_parseFileSize:function(file){var size;if(!file.value)size=(file.fileSize!==null&&file.fileSize!==undefined)?file.fileSize:file.size;return size},_getValidationDescriptor:function(file){var name,size,fileDescriptor;fileDescriptor={};name=this._parseFileName(file);size=this._parseFileSize(file);fileDescriptor.name=name;if(size)fileDescriptor.size=size;return fileDescriptor},_getValidationDescriptors:function(files){var self=this,fileDescriptors=[];qq.each(files,function(idx,file){fileDescriptors.push(self._getValidationDescriptor(file))});return fileDescriptors},_createParamsStore:function(){var paramsStore={},self=this;return{setParams:function(params,fileId){var paramsCopy={};qq.extend(paramsCopy,params);paramsStore[fileId]=paramsCopy},getParams:function(fileId){var paramsCopy={};if(fileId!=null&&paramsStore[fileId]){qq.extend(paramsCopy,paramsStore[fileId])}else qq.extend(paramsCopy,self._options.request.params);return paramsCopy},remove:function(fileId){return delete paramsStore[fileId]},reset:function(){paramsStore={}}}},_createEndpointStore:function(){var endpointStore={},self=this;return{setEndpoint:function(endpoint,fileId){endpointStore[fileId]=endpoint},getEndpoint:function(fileId){if(fileId!=null&&endpointStore[fileId])return endpointStore[fileId];return self._options.request.endpoint},remove:function(fileId){return delete endpointStore[fileId]},reset:function(){endpointStore={}}}}};qq.DragAndDrop=function(o){"use strict";var options,dz,dirPending,droppedFiles=[],droppedEntriesCount=0,droppedEntriesParsedCount=0,disposeSupport=new qq.DisposeSupport();options={dropArea:null,extraDropzones:[],hideDropzones:true,multiple:true,classes:{dropActive:null},callbacks:{dropProcessing:function(isProcessing,files){},error:function(code,filename){},log:function(message,level){}}};qq.extend(options,o)
function maybeUploadDroppedFiles(){if(droppedEntriesCount===droppedEntriesParsedCount&&!dirPending){options.callbacks.log('Grabbed '+droppedFiles.length+" files after tree traversal.");dz.dropDisabled(false);options.callbacks.dropProcessing(false,droppedFiles)}}
function addDroppedFile(file){droppedFiles.push(file);droppedEntriesParsedCount+=1;maybeUploadDroppedFiles()}
function traverseFileTree(entry){var dirReader,i;droppedEntriesCount+=1;if(entry.isFile){entry.file(function(file){addDroppedFile(file)})}else if(entry.isDirectory){dirPending=true;dirReader=entry.createReader();dirReader.readEntries(function(entries){droppedEntriesParsedCount+=1;for(i=0;i<entries.length;i+=1)traverseFileTree(entries[i]);dirPending=false;if(!entries.length)maybeUploadDroppedFiles()})}}
function handleDataTransfer(dataTransfer){var i,items,entry;options.callbacks.dropProcessing(true);dz.dropDisabled(true);if(dataTransfer.files.length>1&&!options.multiple){options.callbacks.dropProcessing(false);options.callbacks.error('tooManyFilesError',"");dz.dropDisabled(false)}else{droppedFiles=[];droppedEntriesCount=0;droppedEntriesParsedCount=0;if(qq.isFolderDropSupported(dataTransfer)){items=dataTransfer.items;for(i=0;i<items.length;i+=1){entry=items[i].webkitGetAsEntry();if(entry)if(entry.isFile){droppedFiles.push(items[i].getAsFile());if(i===items.length-1)maybeUploadDroppedFiles()}else traverseFileTree(entry)}}else{options.callbacks.dropProcessing(false,dataTransfer.files);dz.dropDisabled(false)}}}
function setupDropzone(dropArea){dz=new qq.UploadDropZone({element:dropArea,onEnter:function(e){qq(dropArea).addClass(options.classes.dropActive);e.stopPropagation()},onLeaveNotDescendants:function(e){qq(dropArea).removeClass(options.classes.dropActive)},onDrop:function(e){if(options.hideDropzones)qq(dropArea).hide();qq(dropArea).removeClass(options.classes.dropActive);handleDataTransfer(e.dataTransfer)}});disposeSupport.addDisposer(function(){dz.dispose()});if(options.hideDropzones)qq(dropArea).hide()}
function isFileDrag(dragEvent){var fileDrag;qq.each(dragEvent.dataTransfer.types,function(key,val){if(val==='Files'){fileDrag=true;return false}});return fileDrag}
function setupDragDrop(){if(options.dropArea)options.extraDropzones.push(options.dropArea);var i,dropzones=options.extraDropzones;for(i=0;i<dropzones.length;i+=1)setupDropzone(dropzones[i]);if(options.dropArea&&(!qq.ie()||qq.ie10()))disposeSupport.attach(document,'dragenter',function(e){if(!dz.dropDisabled()&&isFileDrag(e)){if(qq(options.dropArea).hasClass(options.classes.dropDisabled))return;options.dropArea.style.display='block';for(i=0;i<dropzones.length;i+=1)dropzones[i].style.display='block'}});disposeSupport.attach(document,'dragleave',function(e){if(options.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(e))for(i=0;i<dropzones.length;i+=1)qq(dropzones[i]).hide()});disposeSupport.attach(document,'drop',function(e){if(options.hideDropzones)for(i=0;i<dropzones.length;i+=1)qq(dropzones[i]).hide();e.preventDefault()})};return{setup:function(){setupDragDrop()},setupExtraDropzone:function(element){options.extraDropzones.push(element);setupDropzone(element)},removeExtraDropzone:function(element){var i,dzs=options.extraDropzones;for(i in dzs)if(dzs[i]===element)return dzs.splice(i,1)},dispose:function(){disposeSupport.dispose();dz.dispose()}}};qq.UploadDropZone=function(o){"use strict";var options,element,preventDrop,dropOutsideDisabled,disposeSupport=new qq.DisposeSupport();options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(options,o);element=options.element
function dragover_should_be_canceled(){return qq.safari()||(qq.firefox()&&qq.windows())}
function disableDropOutside(e){if(!dropOutsideDisabled){if(dragover_should_be_canceled){disposeSupport.attach(document,'dragover',function(e){e.preventDefault()})}else disposeSupport.attach(document,'dragover',function(e){if(e.dataTransfer){e.dataTransfer.dropEffect='none';e.preventDefault()}});dropOutsideDisabled=true}}
function isValidFileDrag(e){if(qq.ie()&&!qq.ie10())return false;var effectTest,dt=e.dataTransfer,isSafari=qq.safari();effectTest=qq.ie10()?true:dt.effectAllowed!=='none';return dt&&effectTest&&(dt.files||(!isSafari&&dt.types.contains&&dt.types.contains('Files')))}
function isOrSetDropDisabled(isDisabled){if(isDisabled!==undefined)preventDrop=isDisabled;return preventDrop}
function attachEvents(){disposeSupport.attach(element,'dragover',function(e){if(!isValidFileDrag(e))return;var effect=qq.ie()?null:e.dataTransfer.effectAllowed;if(effect==='move'||effect==='linkMove'){e.dataTransfer.dropEffect='move'}else e.dataTransfer.dropEffect='copy';e.stopPropagation();e.preventDefault()});disposeSupport.attach(element,'dragenter',function(e){if(!isOrSetDropDisabled()){if(!isValidFileDrag(e))return;options.onEnter(e)}});disposeSupport.attach(element,'dragleave',function(e){if(!isValidFileDrag(e))return;options.onLeave(e);var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);if(qq(this).contains(relatedTarget))return;options.onLeaveNotDescendants(e)});disposeSupport.attach(element,'drop',function(e){if(!isOrSetDropDisabled()){if(!isValidFileDrag(e))return;e.preventDefault();options.onDrop(e)}})};disableDropOutside();attachEvents();return{dropDisabled:function(isDisabled){return isOrSetDropDisabled(isDisabled)},dispose:function(){disposeSupport.dispose()}}};qq.FineUploader=function(o){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:'Upload a file',cancelButton:'Cancel',retryButton:'Retry',failUpload:'Upload failed',dragZone:'Drop files here to upload',dropProcessing:'Processing dropped files...',formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':'')+(!this._options.button?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':'')+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':'')+'</div>',fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:'qq-upload-button',drop:'qq-upload-drop-area',dropActive:'qq-upload-drop-area-active',dropDisabled:'qq-upload-drop-area-disabled',list:'qq-upload-list',progressBar:'qq-progress-bar',file:'qq-upload-file',spinner:'qq-upload-spinner',finished:'qq-upload-finished',retrying:'qq-upload-retrying',retryable:'qq-upload-retryable',size:'qq-upload-size',cancel:'qq-upload-cancel',retry:'qq-upload-retry',statusText:'qq-upload-status-text',success:'qq-upload-success',fail:'qq-upload-fail',successIcon:null,failIcon:null,dropProcessing:'qq-drop-processing',dropProcessingSpinner:'qq-drop-processing-spinner'},failedUploadTextDisplay:{mode:'default',maxChars:50,responseProperty:'error',enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},showMessage:function(message){setTimeout(function(){alert(message)},0)}},true);qq.extend(this._options,o,true);this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,'list');this._classes=this._options.classes;if(!this._button)this._button=this._createUploadButton(this._find(this._element,'button'));this._bindCancelAndRetryEvents();this._dnd=this._setupDragAndDrop()};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(element){this._dnd.setupExtraDropzone(element)},removeExtraDropzone:function(element){return this._dnd.removeExtraDropzone(element)},getItemByFileId:function(id){var item=this._listElement.firstChild;while(item){if(item.qqFileId==id)return item;item=item.nextSibling}},cancel:function(fileId){qq.FineUploaderBasic.prototype.cancel.apply(this,arguments);var item=this.getItemByFileId(fileId);qq(item).remove()},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,'list');if(!this._options.button)this._button=this._createUploadButton(this._find(this._element,'button'));this._bindCancelAndRetryEvents();this._dnd.dispose();this._dnd=this._setupDragAndDrop()},_setupDragAndDrop:function(){var self=this,dropProcessingEl=this._find(this._element,'dropProcessing'),dnd,preventSelectFiles,defaultDropAreaEl;preventSelectFiles=function(event){event.preventDefault()};if(!this._options.dragAndDrop.disableDefaultDropzone)defaultDropAreaEl=this._find(this._options.element,'drop');dnd=new qq.DragAndDrop({dropArea:defaultDropAreaEl,extraDropzones:this._options.dragAndDrop.extraDropzones,hideDropzones:this._options.dragAndDrop.hideDropzones,multiple:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{dropProcessing:function(isProcessing,files){var input=self._button.getInput();if(isProcessing){qq(dropProcessingEl).css({display:'block'});qq(input).attach('click',preventSelectFiles)}else{qq(dropProcessingEl).hide();qq(input).detach('click',preventSelectFiles)};if(files)self.addFiles(files)},error:function(code,filename){self._error(code,filename)},log:function(message,level){self.log(message,level)}}});dnd.setup();return dnd},_leaving_document_out:function(e){return((qq.chrome()||(qq.safari()&&qq.windows()))&&e.clientX==0&&e.clientY==0)||(qq.firefox()&&!e.relatedTarget)},_storeFileForLater:function(id){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var item=this.getItemByFileId(id);qq(this._find(item,'spinner')).hide()},_find:function(parent,type){var element=qq(parent).getByClass(this._options.classes[type])[0];if(!element)throw new Error('element not found '+type);return element},_onSubmit:function(id,fileName){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(id,fileName)},_onProgress:function(id,fileName,loaded,total){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var item,progressBar,text,percent,cancelLink,size;item=this.getItemByFileId(id);progressBar=this._find(item,'progressBar');percent=Math.round(loaded/total*100);if(loaded===total){cancelLink=this._find(item,'cancel');qq(cancelLink).hide();qq(progressBar).hide();qq(this._find(item,'statusText')).setText(this._options.text.waitingForResponse);text=this._formatSize(total)}else{text=this._formatProgress(loaded,total);qq(progressBar).css({display:'block'})};qq(progressBar).css({width:percent+'%'});size=this._find(item,'size');qq(size).css({display:'inline'});qq(size).setText(text)},_onComplete:function(id,fileName,result,xhr){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var item=this.getItemByFileId(id);qq(this._find(item,'statusText')).clearText();qq(item).removeClass(this._classes.retrying);qq(this._find(item,'progressBar')).hide();if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported())qq(this._find(item,'cancel')).hide();qq(this._find(item,'spinner')).hide();if(result.success){qq(item).addClass(this._classes.success);if(this._classes.successIcon){this._find(item,'finished').style.display="inline-block";qq(item).addClass(this._classes.successIcon)}}else{qq(item).addClass(this._classes.fail);if(this._classes.failIcon){this._find(item,'finished').style.display="inline-block";qq(item).addClass(this._classes.failIcon)};if(this._options.retry.showButton&&!this._preventRetries[id])qq(item).addClass(this._classes.retryable);this._controlFailureTextDisplay(item,result)}},_onUpload:function(id,fileName){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var item=this.getItemByFileId(id);this._showSpinner(item)},_onBeforeAutoRetry:function(id){var item,progressBar,cancelLink,failTextEl,retryNumForDisplay,maxAuto,retryNote;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);item=this.getItemByFileId(id);progressBar=this._find(item,'progressBar');this._showCancelLink(item);progressBar.style.width=0;qq(progressBar).hide();if(this._options.retry.showAutoRetryNote){failTextEl=this._find(item,'statusText');retryNumForDisplay=this._autoRetries[id]+1;maxAuto=this._options.retry.maxAutoAttempts;retryNote=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,retryNumForDisplay);retryNote=retryNote.replace(/\{maxAuto\}/g,maxAuto);qq(failTextEl).setText(retryNote);if(retryNumForDisplay===1)qq(item).addClass(this._classes.retrying)}},_onBeforeManualRetry:function(id){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var item=this.getItemByFileId(id);this._find(item,'progressBar').style.width=0;qq(item).removeClass(this._classes.fail);qq(this._find(item,'statusText')).clearText();this._showSpinner(item);this._showCancelLink(item);return true};return false},_addToList:function(id,fileName){var item=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()){var cancelLink=this._find(item,'cancel');qq(cancelLink).remove()};item.qqFileId=id;var fileElement=this._find(item,'file');qq(fileElement).setText(this._options.formatFileName(fileName));qq(this._find(item,'size')).hide();if(!this._options.multiple)this._clearList();this._listElement.appendChild(item)},_clearList:function(){this._listElement.innerHTML='';this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var self=this,list=this._listElement;this._disposeSupport.attach(list,'click',function(e){e=e||window.event;var target=e.target||e.srcElement;if(qq(target).hasClass(self._classes.cancel)||qq(target).hasClass(self._classes.retry)){qq.preventDefault(e);var item=target.parentNode;while(item.qqFileId==undefined)item=target=target.parentNode;if(qq(target).hasClass(self._classes.cancel)){self.cancel(item.qqFileId)}else{qq(item).removeClass(self._classes.retryable);self.retry(item.qqFileId)}}})},_formatProgress:function(uploadedSize,totalSize){var message=this._options.text.formatProgress
function r(name,replacement){message=message.replace(name,replacement)};r('{percent}',Math.round(uploadedSize/totalSize*100));r('{total_size}',this._formatSize(totalSize));return message},_controlFailureTextDisplay:function(item,response){var mode,maxChars,responseProperty,failureReason,shortFailureReason;mode=this._options.failedUploadTextDisplay.mode;maxChars=this._options.failedUploadTextDisplay.maxChars;responseProperty=this._options.failedUploadTextDisplay.responseProperty;if(mode==='custom'){failureReason=response[responseProperty];if(failureReason){if(failureReason.length>maxChars)shortFailureReason=failureReason.substring(0,maxChars)+'...'}else{failureReason=this._options.text.failUpload;this.log("'"+responseProperty+"' is not a valid property on the server response.",'warn')};qq(this._find(item,'statusText')).setText(shortFailureReason||failureReason);if(this._options.failedUploadTextDisplay.enableTooltip)this._showTooltip(item,failureReason)}else if(mode==='default'){qq(this._find(item,'statusText')).setText(this._options.text.failUpload)}else if(mode!=='none')this.log("failedUploadTextDisplay.mode value of '"+mode+"' is not valid",'warn')},_showTooltip:function(item,text){item.title=text},_showSpinner:function(item){var spinnerEl=this._find(item,'spinner');spinnerEl.style.display="inline-block"},_showCancelLink:function(item){if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported()){var cancelLink=this._find(item,'cancel');cancelLink.style.display='inline'}},_error:function(code,fileName){var message=qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(message)}});qq.UploadHandler=function(o){"use strict";var queue=[],options,log,dequeue,handlerImpl;options={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},maxConnections:3,uuidParamName:'qquuid',totalFileSizeParamName:'qqtotalfilesize',chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:'qqpartindex',partByteOffset:'qqpartbyteoffset',chunkSize:'qqchunksize',totalParts:'qqtotalparts',filename:'qqfilename'}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},log:function(str,level){},onProgress:function(id,fileName,loaded,total){},onComplete:function(id,fileName,response,xhr){},onCancel:function(id,fileName){},onUpload:function(id,fileName){},onUploadChunk:function(id,fileName,chunkData){},onAutoRetry:function(id,fileName,response,xhr){},onResume:function(id,fileName,chunkData){}};qq.extend(options,o);log=options.log;dequeue=function(id){var i=qq.indexOf(queue,id),max=options.maxConnections,nextId;queue.splice(i,1);if(queue.length>=max&&i<max){nextId=queue[max-1];handlerImpl.upload(nextId)}};if(qq.isXhrUploadSupported()){handlerImpl=new qq.UploadHandlerXhr(options,dequeue,log)}else handlerImpl=new qq.UploadHandlerForm(options,dequeue,log);return{add:function(file){return handlerImpl.add(file)},upload:function(id){var len=queue.push(id);if(len<=options.maxConnections)return handlerImpl.upload(id)},retry:function(id){var i=qq.indexOf(queue,id);if(i>=0){return handlerImpl.upload(id,true)}else return this.upload(id)},cancel:function(id){log('Cancelling '+id);options.paramsStore.remove(id);handlerImpl.cancel(id);dequeue(id)},cancelAll:function(){qq.each(queue,function(idx,fileId){this.cancel(fileId)});queue=[]},getName:function(id){return handlerImpl.getName(id)},getSize:function(id){if(handlerImpl.getSize)return handlerImpl.getSize(id)},getFile:function(id){if(handlerImpl.getFile)return handlerImpl.getFile(id)},getQueue:function(){return queue},reset:function(){log('Resetting upload handler');queue=[];handlerImpl.reset()},getUuid:function(id){return handlerImpl.getUuid(id)},isValid:function(id){return handlerImpl.isValid(id)},getResumableFilesData:function(){if(handlerImpl.getResumableFilesData)return handlerImpl.getResumableFilesData();return[]}}};qq.UploadHandlerForm=function(o,uploadCompleteCallback,logCallback){"use strict";var options=o,inputs=[],uuids=[],detachLoadEvents={},uploadComplete=uploadCompleteCallback,log=logCallback,api
function attachLoadEvent(iframe,callback){detachLoadEvents[iframe.id]=qq(iframe).attach('load',function(){log('Received response for '+iframe.id);if(!iframe.parentNode)return;try{if(iframe.contentDocument&&iframe.contentDocument.body&&iframe.contentDocument.body.innerHTML=="false")return}catch(error){log('Error when attempting to access iframe during handling of upload response ('+error+")",'error')};callback()})}
function getIframeContentJson(iframe){var response;try{var doc=iframe.contentDocument||iframe.contentWindow.document,innerHTML=doc.body.innerHTML;log("converting iframe's innerHTML to JSON");log("innerHTML = "+innerHTML);if(innerHTML&&innerHTML.match(/^<pre/i))innerHTML=doc.body.firstChild.firstChild.nodeValue;response=eval("("+innerHTML+")")}catch(error){log('Error when attempting to parse form upload response ('+error+")",'error');response={success:false}};return response}
function createIframe(id){var iframe=qq.toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.setAttribute('id',id);iframe.style.display='none';document.body.appendChild(iframe);return iframe}
function createForm(id,iframe){var params=options.paramsStore.getParams(id),protocol=options.demoMode?"GET":"POST",form=qq.toElement('<form method="'+protocol+'" enctype="multipart/form-data"></form>'),endpoint=options.endpointStore.getEndpoint(id),url=endpoint;params[options.uuidParamName]=uuids[id];if(!options.paramsInBody){url=qq.obj2url(params,endpoint)}else qq.obj2Inputs(params,form);form.setAttribute('action',url);form.setAttribute('target',iframe.name);form.style.display='none';document.body.appendChild(form);return form};api={add:function(fileInput){fileInput.setAttribute('name',options.inputName);var id=inputs.push(fileInput)-1;uuids[id]=qq.getUniqueId();if(fileInput.parentNode)qq(fileInput).remove();return id},getName:function(id){return inputs[id].value.replace(/.*(\/|\\)/,"")},isValid:function(id){return inputs[id]!==undefined},reset:function(){qq.UploadHandler.prototype.reset.apply(this,arguments);inputs=[];uuids=[];detachLoadEvents={}},getUuid:function(id){return uuids[id]},cancel:function(id){options.onCancel(id,this.getName(id));delete inputs[id];delete uuids[id];delete detachLoadEvents[id];var iframe=document.getElementById(id);if(iframe){iframe.setAttribute('src','java'+String.fromCharCode(115)+'cript:false;');qq(iframe).remove()}},upload:function(id){var input=inputs[id],fileName=api.getName(id),iframe=createIframe(id),form=createForm(id,iframe);if(!input)throw new Error('file with passed id was not added, or already uploaded or cancelled');options.onUpload(id,this.getName(id));form.appendChild(input);attachLoadEvent(iframe,function(){log('iframe loaded');var response=getIframeContentJson(iframe);setTimeout(function(){detachLoadEvents[id]();delete detachLoadEvents[id];qq(iframe).remove()},1);if(!response.success)if(options.onAutoRetry(id,fileName,response))return;options.onComplete(id,fileName,response);uploadComplete(id)});log('Sending upload request for '+id);form.submit();qq(form).remove();return id}};return api};qq.UploadHandlerXhr=function(o,uploadCompleteCallback,logCallback){"use strict";var options=o,uploadComplete=uploadCompleteCallback,log=logCallback,fileState=[],cookieItemDelimiter="|",chunkFiles=options.chunking.enabled&&qq.isFileChunkingSupported(),resumeEnabled=options.resume.enabled&&chunkFiles&&qq.areCookiesEnabled(),resumeId=getResumeId(),multipart=options.forceMultipart||options.paramsInBody,api
function addChunkingSpecificParams(id,params,chunkData){var size=api.getSize(id),name=api.getName(id);params[options.chunking.paramNames.partIndex]=chunkData.part;params[options.chunking.paramNames.partByteOffset]=chunkData.start;params[options.chunking.paramNames.chunkSize]=chunkData.end-chunkData.start;params[options.chunking.paramNames.totalParts]=chunkData.count;params[options.totalFileSizeParamName]=size;if(multipart)params[options.chunking.paramNames.filename]=name}
function addResumeSpecificParams(params){params[options.resume.paramNames.resuming]=true}
function getChunk(file,startByte,endByte){if(file.slice){return file.slice(startByte,endByte)}else if(file.mozSlice){return file.mozSlice(startByte,endByte)}else if(file.webkitSlice)return file.webkitSlice(startByte,endByte)}
function getChunkData(id,chunkIndex){var chunkSize=options.chunking.partSize,fileSize=api.getSize(id),file=fileState[id].file,startBytes=chunkSize*chunkIndex,endBytes=startBytes+chunkSize>=fileSize?fileSize:startBytes+chunkSize,totalChunks=getTotalChunks(id);return{part:chunkIndex,start:startBytes,end:endBytes,count:totalChunks,blob:getChunk(file,startBytes,endBytes)}}
function getTotalChunks(id){var fileSize=api.getSize(id),chunkSize=options.chunking.partSize;return Math.ceil(fileSize/chunkSize)}
function createXhr(id){fileState[id].xhr=new XMLHttpRequest();return fileState[id].xhr}
function setParamsAndGetEntityToSend(params,xhr,fileOrBlob,id){var formData=new FormData(),protocol=options.demoMode?"GET":"POST",endpoint=options.endpointStore.getEndpoint(id),url=endpoint,name=api.getName(id),size=api.getSize(id);params[options.uuidParamName]=fileState[id].uuid;if(multipart)params[options.totalFileSizeParamName]=size;if(!options.paramsInBody){params[options.inputName]=name;url=qq.obj2url(params,endpoint)};xhr.open(protocol,url,true);if(multipart){if(options.paramsInBody)qq.obj2FormData(params,formData);formData.append(options.inputName,fileOrBlob);return formData};return fileOrBlob}
function setHeaders(id,xhr){var extraHeaders=options.customHeaders,name=api.getName(id),file=fileState[id].file;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Cache-Control","no-cache");if(!multipart){xhr.setRequestHeader("Content-Type","application/octet-stream");xhr.setRequestHeader("X-Mime-Type",file.type)};qq.each(extraHeaders,function(name,val){xhr.setRequestHeader(name,val)})}
function handleCompletedFile(id,response,xhr){var name=api.getName(id),size=api.getSize(id);fileState[id].attemptingResume=false;options.onProgress(id,name,size,size);options.onComplete(id,name,response,xhr);delete fileState[id].xhr;uploadComplete(id)}
function uploadNextChunk(id){var chunkData=getChunkData(id,fileState[id].remainingChunkIdxs[0]),xhr=createXhr(id),size=api.getSize(id),name=api.getName(id),toSend,params;if(fileState[id].loaded===undefined)fileState[id].loaded=0;persistChunkData(id,chunkData);xhr.onreadystatechange=getReadyStateChangeHandler(id,xhr);xhr.upload.onprogress=function(e){if(e.lengthComputable)if(fileState[id].loaded<size){var totalLoaded=e.loaded+fileState[id].loaded;options.onProgress(id,name,totalLoaded,size)}};options.onUploadChunk(id,name,getChunkDataForCallback(chunkData));params=options.paramsStore.getParams(id);addChunkingSpecificParams(id,params,chunkData);if(fileState[id].attemptingResume)addResumeSpecificParams(params);toSend=setParamsAndGetEntityToSend(params,xhr,chunkData.blob,id);setHeaders(id,xhr);log('Sending chunked upload request for '+id+": bytes "+(chunkData.start+1)+"-"+chunkData.end+" of "+size);xhr.send(toSend)}
function handleSuccessfullyCompletedChunk(id,response,xhr){var chunkIdx=fileState[id].remainingChunkIdxs.shift(),chunkData=getChunkData(id,chunkIdx);fileState[id].attemptingResume=false;fileState[id].loaded+=chunkData.end-chunkData.start;if(fileState[id].remainingChunkIdxs.length>0){uploadNextChunk(id)}else{deletePersistedChunkData(id);handleCompletedFile(id,response,xhr)}}
function isErrorResponse(xhr,response){return xhr.status!==200||!response.success||response.reset}
function parseResponse(xhr){var response;try{response=qq.parseJson(xhr.responseText)}catch(error){log('Error when attempting to parse xhr response text ('+error+')','error');response={}};return response}
function handleResetResponse(id){log('Server has ordered chunking effort to be restarted on next attempt for file ID '+id,'error');if(resumeEnabled)deletePersistedChunkData(id);fileState[id].remainingChunkIdxs=[];delete fileState[id].loaded}
function handleResetResponseOnResumeAttempt(id){fileState[id].attemptingResume=false;log("Server has declared that it cannot handle resume for file ID "+id+" - starting from the first chunk",'error');api.upload(id,true)}
function handleNonResetErrorResponse(id,response,xhr){var name=api.getName(id);if(options.onAutoRetry(id,name,response,xhr)){return}else handleCompletedFile(id,response,xhr)}
function onComplete(id,xhr){var response;if(!fileState[id])return;log("xhr - server response received for "+id);log("responseText = "+xhr.responseText);response=parseResponse(xhr);if(isErrorResponse(xhr,response)){if(response.reset)handleResetResponse(id);if(fileState[id].attemptingResume&&response.reset){handleResetResponseOnResumeAttempt(id)}else handleNonResetErrorResponse(id,response,xhr)}else if(chunkFiles){handleSuccessfullyCompletedChunk(id,response,xhr)}else handleCompletedFile(id,response,xhr)}
function getChunkDataForCallback(chunkData){return{partIndex:chunkData.part,startByte:chunkData.start+1,endByte:chunkData.end,totalParts:chunkData.count}}
function getReadyStateChangeHandler(id,xhr){return function(){if(xhr.readyState===4)onComplete(id,xhr)}}
function persistChunkData(id,chunkData){var fileUuid=api.getUuid(id),cookieName=getChunkDataCookieName(id),cookieValue=fileUuid+cookieItemDelimiter+chunkData.part,cookieExpDays=options.resume.cookiesExpireIn;qq.setCookie(cookieName,cookieValue,cookieExpDays)}
function deletePersistedChunkData(id){var cookieName=getChunkDataCookieName(id);qq.deleteCookie(cookieName)}
function getPersistedChunkData(id){var chunkCookieValue=qq.getCookie(getChunkDataCookieName(id)),delimiterIndex,uuid,partIndex;if(chunkCookieValue){delimiterIndex=chunkCookieValue.indexOf(cookieItemDelimiter);uuid=chunkCookieValue.substr(0,delimiterIndex);partIndex=parseInt(chunkCookieValue.substr(delimiterIndex+1,chunkCookieValue.length-delimiterIndex),10);return{uuid:uuid,part:partIndex}}}
function getChunkDataCookieName(id){var filename=api.getName(id),fileSize=api.getSize(id),maxChunkSize=options.chunking.partSize,cookieName;cookieName="qqfilechunk"+cookieItemDelimiter+encodeURIComponent(filename)+cookieItemDelimiter+fileSize+cookieItemDelimiter+maxChunkSize;if(resumeId!==undefined)cookieName+=cookieItemDelimiter+resumeId;return cookieName}
function getResumeId(){if(options.resume.id!==null&&options.resume.id!==undefined&&!qq.isFunction(options.resume.id)&&!qq.isObject(options.resume.id))return options.resume.id}
function handleFileChunkingUpload(id,retry){var name=api.getName(id),firstChunkIndex=0,persistedChunkInfoForResume,firstChunkDataForResume,currentChunkIndex;if(!fileState[id].remainingChunkIdxs||fileState[id].remainingChunkIdxs.length===0){fileState[id].remainingChunkIdxs=[];if(resumeEnabled&&!retry){persistedChunkInfoForResume=getPersistedChunkData(id);if(persistedChunkInfoForResume){firstChunkDataForResume=getChunkData(id,persistedChunkInfoForResume.part);if(options.onResume(id,name,getChunkDataForCallback(firstChunkDataForResume))!==false){firstChunkIndex=persistedChunkInfoForResume.part;fileState[id].uuid=persistedChunkInfoForResume.uuid;fileState[id].loaded=firstChunkDataForResume.start;fileState[id].attemptingResume=true;log('Resuming '+name+" at partition index "+firstChunkIndex)}}};for(currentChunkIndex=getTotalChunks(id)-1;currentChunkIndex>=firstChunkIndex;currentChunkIndex-=1)fileState[id].remainingChunkIdxs.unshift(currentChunkIndex)};uploadNextChunk(id)}
function handleStandardFileUpload(id){var file=fileState[id].file,name=api.getName(id),xhr,params,toSend;fileState[id].loaded=0;xhr=createXhr(id);xhr.upload.onprogress=function(e){if(e.lengthComputable){fileState[id].loaded=e.loaded;options.onProgress(id,name,e.loaded,e.total)}};xhr.onreadystatechange=getReadyStateChangeHandler(id,xhr);params=options.paramsStore.getParams(id);toSend=setParamsAndGetEntityToSend(params,xhr,file,id);setHeaders(id,xhr);log('Sending upload request for '+id);xhr.send(toSend)};api={add:function(file){if(!(file instanceof File))throw new Error('Passed obj in not a File (in qq.UploadHandlerXhr)');var id=fileState.push({file:file})-1;fileState[id].uuid=qq.getUniqueId();return id},getName:function(id){var file=fileState[id].file;return(file.fileName!==null&&file.fileName!==undefined)?file.fileName:file.name},getSize:function(id){var file=fileState[id].file;return file.fileSize!=null?file.fileSize:file.size},getFile:function(id){if(fileState[id])return fileState[id].file},getLoaded:function(id){return fileState[id].loaded||0},isValid:function(id){return fileState[id]!==undefined},reset:function(){fileState=[]},getUuid:function(id){return fileState[id].uuid},upload:function(id,retry){var name=this.getName(id);options.onUpload(id,name);if(chunkFiles){handleFileChunkingUpload(id,retry)}else handleStandardFileUpload(id)},cancel:function(id){options.onCancel(id,this.getName(id));if(fileState[id].xhr)fileState[id].xhr.abort();if(resumeEnabled)deletePersistedChunkData(id);delete fileState[id]},getResumableFilesData:function(){var matchingCookieNames=[],resumableFilesData=[];if(chunkFiles&&resumeEnabled){if(resumeId===undefined){matchingCookieNames=qq.getCookieNames(new RegExp("^qqfilechunk\\"+cookieItemDelimiter+".+\\"+cookieItemDelimiter+"\\d+\\"+cookieItemDelimiter+options.chunking.partSize+"="))}else matchingCookieNames=qq.getCookieNames(new RegExp("^qqfilechunk\\"+cookieItemDelimiter+".+\\"+cookieItemDelimiter+"\\d+\\"+cookieItemDelimiter+options.chunking.partSize+"\\"+cookieItemDelimiter+resumeId+"="));qq.each(matchingCookieNames,function(idx,cookieName){var cookiesNameParts=cookieName.split(cookieItemDelimiter),cookieValueParts=qq.getCookie(cookieName).split(cookieItemDelimiter);resumableFilesData.push({name:decodeURIComponent(cookiesNameParts[1]),size:cookiesNameParts[2],uuid:cookieValueParts[0],partIdx:cookieValueParts[1]})});return resumableFilesData};return[]}};return api};(function($){"use strict";var uploader,$el,init,dataStore,pluginOption,pluginOptions,addCallbacks,transformVariables,isValidCommand,delegateCommand;pluginOptions=['uploaderType'];init=function(options){if(options){var xformedOpts=transformVariables(options);addCallbacks(xformedOpts);if(pluginOption('uploaderType')==='basic'){uploader(new qq.FineUploaderBasic(xformedOpts))}else uploader(new qq.FineUploader(xformedOpts))};return $el};dataStore=function(key,val){var data=$el.data('fineuploader');if(val){if(data===undefined)data={};data[key]=val;$el.data('fineuploader',data)}else{if(data===undefined)return null;return data[key]}};uploader=function(instanceToStore){return dataStore('uploader',instanceToStore)};pluginOption=function(option,optionVal){return dataStore(option,optionVal)};addCallbacks=function(transformedOpts){var callbacks=transformedOpts.callbacks={};$.each(new qq.FineUploaderBasic()._options.callbacks,function(prop,func){var name,$callbackEl;name=/^on(\w+)/.exec(prop)[1];name=name.substring(0,1).toLowerCase()+name.substring(1);$callbackEl=$el;callbacks[prop]=function(){var args=Array.prototype.slice.call(arguments);return $callbackEl.triggerHandler(name,args)}})};transformVariables=function(source,dest){var xformed,arrayVals;if(dest===undefined){if(source.uploaderType!=='basic'){xformed={element:$el[0]}}else xformed={}}else xformed=dest;$.each(source,function(prop,val){if($.inArray(prop,pluginOptions)>=0){pluginOption(prop,val)}else if(val instanceof $){xformed[prop]=val[0]}else if($.isPlainObject(val)){xformed[prop]={};transformVariables(val,xformed[prop])}else if($.isArray(val)){arrayVals=[];$.each(val,function(idx,arrayVal){if(arrayVal instanceof $){$.merge(arrayVals,arrayVal)}else arrayVals.push(arrayVal)});xformed[prop]=arrayVals}else xformed[prop]=val});if(dest===undefined)return xformed};isValidCommand=function(command){return $.type(command)==="string"&&!command.match(/^_/)&&uploader()[command]!==undefined};delegateCommand=function(command){var xformedArgs=[],origArgs=Array.prototype.slice.call(arguments,1);transformVariables(origArgs,xformedArgs);return uploader()[command].apply(uploader(),xformedArgs)};$.fn.fineUploader=function(optionsOrCommand){var self=this,selfArgs=arguments,retVals=[];this.each(function(index,el){$el=$(el);if(uploader()&&isValidCommand(optionsOrCommand)){retVals.push(delegateCommand.apply(self,selfArgs));if(self.length===1)return false}else if(typeof optionsOrCommand==='object'||!optionsOrCommand){init.apply(self,selfArgs)}else $.error('Method '+optionsOrCommand+' does not exist on jQuery.fineUploader')});if(retVals.length===1){return retVals[0]}else if(retVals.length>1)return retVals;return this}})(jQuery);
(function($){"use strict";$(document).ready(function($){$('#tabs .panel:not(#tabs .panel)').hide();$('div#tabs ul.tabs li > a').click(function(){var href=$(this).attr('href');$('#tabs li').removeClass('active');$('div.panel').hide();$('div'+href).show();$(this).parent().addClass('active');return false});if($('#tabs li.active').size()==0){$('#tabs li:first a').click()}else $('#tabs li.active a').click();$('#review_form_wrapper').hide();if(jigoshop_params.load_fancybox)$('a.show_review_form').prettyPhoto({animation_speed:'normal',slideshow:5e3,autoplay_slideshow:false,show_title:false,theme:'pp_default',horizontal_padding:50,opacity:0.7,deeplinking:false,social_tools:false});$('#rating').hide().before('<p class="stars"><span><a class="star-1" href="#">1</a><a class="star-2" href="#">2</a><a class="star-3" href="#">3</a><a class="star-4" href="#">4</a><a class="star-5" href="#">5</a></span></p>');$('body').on('click','#respond p.stars a',function(){var $star=$(this),$rating=$(this).closest('#respond').find('#rating');$rating.val($star.text());$star.siblings('a').removeClass('active');$star.addClass('active');return false}).on('click','#respond #submit',function(){var $rating=$(this).closest('#respond').find('#rating'),rating=$rating.val();if($rating.size()>0&&!rating){alert(jigoshop_params.ratings_message);return false}})})})(jQuery);